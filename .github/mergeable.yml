version: 2
mergeable:
- when: pull_request.*, pull_request_review.*, status.*, check_suite.*
  name: "Automatically merge pull requests once it passes all checks"
    validate: []
    pass:
      - do: merge
        merge_method: "squash"
        
- when: pull_request.*, pull_request_review.*
  name: 'PR title and description checks'     
  validate:
  - do: description
    no_empty:
      enabled: true
    and:
    - must_include:
        regex: \[[a-zA-Z]{2,6}-\d{1,7}\]
        regex_flag: none
    - must_include:
        regex: \[[a-zA-Z]{2,6}-\d{1,7}\]:\shttps:\/\/nextraq.+
        regex_flag: none
        message: >
          Couldn't find a Jira ticket number to automagically link your ticket.  Please add one.
  - do: title
    no_empty:
      enabled: true
    must_include:
      regex: \[[a-zA-Z]{2,6}-\d{1,7}\]
      regex_flag: none

  fail:
  - do: comment
    payload:
      body: >
        Please include the ticket in title/description in square brackets (ex: [AAA-123]).

- when: pull_request.*, issues.*
  name: "Label Validation check"
  validate:
  - do: title
    must_exclude:
      regex: ^\[WIP\]
  - do: label
    must_exclude:
      regex: WIP
  pass:
  - do: labels
    labels: [WIP]
    mode: delete
  fail:
  - do: labels
    labels: [WIP]
